import{a4 as e,w as t,x as l,r as a,aq as s,f as n,z as o,d as u,l as i,a as c,o as r,n as d,R as p,h as b,_ as m,ar as f,b as x,i as g,V as h,W as v,N as w,g as C,as as k,T as y,Y as z,Z as U,L as P}from"./chunk-BHPLqMYJ.js";import{u as L,i as D,d as V}from"./chunk-BIzIzNtG.js";import{_ as j}from"./chunk-DrZHVKnQ.js";function S(){const u=e.useToast(),i=t.createInstance({name:"imgStore"}),c=L().prizeConfig,r=L().globalConfig,{getPrizeConfig:d,getCurrentPrize:p}=l(c),{getImageList:b}=l(r),m=a([]),f=a(s(d.value)),x=a();return n(()=>{!async function(){(await i.keys()).length>0&&i.iterate((e,t)=>{m.value.push({key:t,value:e})})}()}),o(()=>f.value,e=>{c.setPrizeConfig(e)},{deep:!0}),{addPrize:function(){const e={id:(new Date).getTime().toString(),name:D.global.t("data.prizeName"),sort:0,isAll:!1,count:1,isUsedCount:0,picture:{id:"",name:"",url:""},separateCount:{enable:!1,countList:[]},desc:"",isUsed:!1,isShow:!0,frequency:1};f.value.push(e),u.success(D.global.t("error.success"))},resetDefault:function(){c.resetDefault(),f.value=s(d.value),u.success(D.global.t("error.success"))},delAll:async function(){f.value=[],u.success(D.global.t("error.success"))},delItem:function(e){c.deletePrizeConfig(e.id),u.success(D.global.t("error.deleteSuccess"))},prizeList:f,currentPrize:p,selectedPrize:x,submitData:function(e){x.value.separateCount.countList=e,x.value=null},changePrizePerson:function(e){let t=-1;for(let l=0;l<f.value.length;l++)if(f.value[l].id===e.id){t=l;break}t>-1&&(f.value[t].separateCount.countList=[],f.value[t].isUsed?f.value[t].isUsedCount=f.value[t].count:f.value[t].isUsedCount=0)},changePrizeStatus:function(e){e.isUsed?e.isUsedCount=0:e.isUsedCount=e.count,e.separateCount.countList=[],e.isUsed=!e.isUsed},selectPrize:function(e){x.value=e,x.value.isUsedCount=0,x.value.isUsed=!1,x.value.separateCount.countList.length>1||(x.value.separateCount={enable:!0,countList:[{id:"0",count:e.count,isUsedCount:0}]})},localImageList:b}}const A={class:"flex w-full gap-3"},I={role:"alert",class:"w-full my-4 alert alert-info"},_={class:"flex items-center justify-center max-w-xs px-2 handle form-control"},N={class:"w-1/2 max-w-xs form-control"},T={class:"label"},M={class:"label-text"},q=["onUpdate:modelValue","placeholder"],H={class:"flex items-center w-1/2 max-w-xs gap-2 form-control"},R={class:"label"},B={class:"label-text"},W=["checked","onChange"],Y={class:"w-1/2 max-w-xs form-control"},Z={class:"label"},E={class:"label-text"},F=["onUpdate:modelValue","placeholder","onChange"],G=["data-tip"],J=["value","max"],K={class:"flex items-center w-1/2 max-w-xs gap-2 form-control"},O={class:"label"},Q={class:"label-text"},X=["checked","onChange"],$={class:"w-full max-w-xs form-control"},ee={class:"label"},te={class:"label-text"},le=["onUpdate:modelValue"],ae={key:0,value:{id:"",name:"",url:""}},se={disabled:"",selected:""},ne=["title","value"],oe={class:"truncate w-option-xs"},ue={key:0,class:"w-full max-w-xs form-control"},ie={class:"label"},ce={class:"label-text"},re=["onClick"],de={key:0,class:"flex flex-wrap w-full h-full gap-1 p-0 pt-1 m-0 cursor-pointer"},pe=["data-tip"],be={key:1,class:"btn btn-secondary btn-xs"},me={class:"w-full max-w-xs form-control"},fe={class:"label"},xe={class:"label-text"},ge={class:"flex gap-2"},he=["onClick"],ve=u({__name:"PrizeConfig",setup(e){const{addPrize:t,resetDefault:l,delAll:a,delItem:s,prizeList:n,currentPrize:o,selectedPrize:u,submitData:L,changePrizePerson:D,changePrizeStatus:ve,selectPrize:we,localImageList:Ce}=S(),{t:ke}=i();return(e,i)=>{var S,ye;return r(),c("div",null,[d(j,{title:b(ke)("viewTitle.prizeManagement")},{buttons:p(()=>[x("div",A,[x("button",{class:"btn btn-info btn-sm",onClick:i[0]||(i[0]=(...e)=>b(t)&&b(t)(...e))},g(b(ke)("button.add")),1),x("button",{class:"btn btn-info btn-sm",onClick:i[1]||(i[1]=(...e)=>b(l)&&b(l)(...e))},g(b(ke)("button.resetDefault")),1),x("button",{class:"btn btn-error btn-sm",onClick:i[2]||(i[2]=(...e)=>b(a)&&b(a)(...e))},g(b(ke)("button.allDelete")),1)])]),alerts:p(()=>[x("div",I,[i[4]||(i[4]=x("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 stroke-current shrink-0"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),x("span",null,g(b(ke)("dialog.tipResetPrize")),1)])]),_:1},8,["title"]),d(b(f),{modelValue:b(n),"onUpdate:modelValue":i[3]||(i[3]=e=>m(n)?n.value=e:null),animation:150,handle:".handle",class:"p-0 m-0"},{default:p(()=>[(r(!0),c(h,null,v(b(n),e=>(r(),c("div",{key:e.id,class:w(["flex items-center justify-center gap-10 py-5",b(o).id===e.id?"border border-dotted rounded-xl":null])},[x("label",_,[d(b(k),{class:"w-10 h-10 cursor-move handle"})]),x("label",N,[x("div",T,[x("span",M,g(b(ke)("table.prizeName")),1)]),y(x("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:b(ke)("placeHolder.name"),class:"w-full max-w-xs input-sm input input-bordered"},null,8,q),[[z,e.name]])]),x("label",H,[x("div",R,[x("span",B,g(b(ke)("table.fullParticipation")),1)]),x("input",{type:"checkbox",checked:e.isAll,class:"border-solid checkbox checkbox-secondary border",onChange:t=>e.isAll=!e.isAll},null,40,W)]),x("label",Y,[x("div",Z,[x("span",E,g(b(ke)("table.numberParticipants")),1)]),y(x("input",{"onUpdate:modelValue":t=>e.count=t,type:"number",placeholder:b(ke)("placeHolder.winnerCount"),class:"w-full max-w-xs p-0 m-0 input-sm input input-bordered",onChange:t=>b(D)(e)},null,40,F),[[z,e.count]]),x("div",{class:"tooltip tooltip-bottom","data-tip":"".concat(b(ke)("table.isDone")+e.isUsedCount,"/").concat(e.count)},[x("progress",{class:"w-full progress",value:e.isUsedCount,max:e.count},null,8,J)],8,G)]),x("label",K,[x("div",O,[x("span",Q,g(b(ke)("table.isDone")),1)]),x("input",{type:"checkbox",checked:e.isUsed,class:"border-solid checkbox checkbox-secondary border",onChange:t=>b(ve)(e)},null,40,X)]),x("label",$,[x("div",ee,[x("span",te,g(b(ke)("table.image")),1)]),y(x("select",{"onUpdate:modelValue":t=>e.picture=t,class:"truncate select select-warning select-sm"},[e.picture.id?(r(),c("option",ae,"âŒ")):C("",!0),x("option",se,g(b(ke)("table.selectPicture")),1),(r(!0),c(h,null,v(b(Ce),e=>(r(),c("option",{key:e.id,title:e.name,class:"w-full max-w-full",value:e},[x("span",oe,g(e.name),1)],8,ne))),128))],8,le),[[U,e.picture]])]),e.separateCount?(r(),c("label",ue,[x("div",ie,[x("span",ce,g(b(ke)("table.onceNumber")),1)]),x("div",{class:"flex justify-start w-full h-full",onClick:t=>b(we)(e)},[e.separateCount.countList.length?(r(),c("ul",de,[(r(!0),c(h,null,v(e.separateCount.countList,e=>(r(),c("li",{key:e.id,class:"relative flex items-center justify-center w-8 h-8 bg-slate-600/60 separated"},[x("div",{class:"flex items-center justify-center w-full h-full tooltip","data-tip":"".concat(b(ke)("tooltip.doneCount")+e.isUsedCount,"/").concat(e.count)},[x("div",{class:"absolute left-0 z-50 h-full bg-blue-300/80",style:P("width:".concat(100*e.isUsedCount/e.count,"%"))},null,4),x("span",null,g(e.count),1)],8,pe)]))),128))])):(r(),c("button",be,g(b(ke)("button.setting")),1))],8,re)])):C("",!0),x("label",me,[x("div",fe,[x("span",xe,g(b(ke)("table.operation")),1)]),x("div",ge,[x("button",{class:"btn btn-error btn-xs",onClick:t=>b(s)(e)},g(b(ke)("button.delete")),9,he)])])],2))),128))]),_:1},8,["modelValue"]),d(V,{"total-number":null==(S=b(u))?void 0:S.count,"separated-number":null==(ye=b(u))?void 0:ye.separateCount.countList,onSubmitData:b(L)},null,8,["total-number","separated-number","onSubmitData"])])}}});export{ve as default};
