import{d as e,r as a,a as t,o as l,b as n,g as s,j as o,m as r,l as i,u as d,T as p,i as u,h as c,Y as b,am as m,a4 as g,x as f,s as v,v as h,an as y,ao as w,k as x,n as D,R as P,V as k,_}from"./chunk-BHPLqMYJ.js";import{_ as T}from"./chunk-CyUKEUR2.js";import{i as R,u as A,a as C,l as O,b as L}from"./chunk-B5vrZrY6.js";import{_ as N}from"./chunk-DrZHVKnQ.js";import{r as j,a as z}from"./chunk-DsM932Ci.js";const W={class:"drawer drawer-end h-0 w-0"},S={class:"drawer-content w-0 h-0 absolute"},U={class:"drawer-side"},V={key:0,class:"menu bg-base-200 min-h-full w-80 p-4"},F=e({__name:"index",setup(e,{expose:r}){const i=a(null),d=a(!1);return r({showDrawer:function(){var e;null==(e=i.value)||e.click(),d.value=!0},closeDrawer:function(){var e;null==(e=i.value)||e.click(),d.value=!1}}),(e,a)=>(l(),t("div",W,[a[1]||(a[1]=n("input",{id:"my-drawer-1",type:"checkbox",class:"drawer-toggle"},null,-1)),n("div",S,[n("label",{ref_key:"drawerTriggerRef",ref:i,for:"my-drawer-1"},null,512)]),n("div",U,[a[0]||(a[0]=n("label",{for:"my-drawer-1","aria-label":"close sidebar",class:"drawer-overlay"},null,-1)),d.value?(l(),t("div",V,[o(e.$slots,"content")])):s("",!0)])]))}}),E={class:"fieldset"},I={class:"label"},J=["placeholder"],M={class:"fieldset"},q={class:"label",required:""},Q=["placeholder"],Y={class:"validator-hint hidden"},$={class:"fieldset"},B={class:"label"},G=["placeholder"],H={class:"fieldset"},K={class:"label"},X=["placeholder"],Z={class:"fieldset"},ee={class:"label"},ae=["placeholder"],te={class:"btn btn-neutral mt-4",type:"submit"},le=e({__name:"SinglePerson",props:r({addOnePersonDrawerRef:{},addOnePerson:{type:Function}},{singlePersonData:{required:!0},singlePersonDataModifiers:{}}),emits:["update:singlePersonData"],setup(e){const{t:a}=i(),s=d(e,"singlePersonData");return(o,r)=>(l(),t("form",{class:"fieldset rounded-box w-xs p-4",onSubmit:r[6]||(r[6]=a=>e.addOnePerson(e.addOnePersonDrawerRef,a))},[n("label",E,[n("span",I,u(c(a)("table.number")),1),p(n("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>s.value.uid=e),type:"text",class:"input validator",placeholder:c(a)("table.number")},null,8,J),[[b,s.value.uid]])]),n("fieldset",M,[n("label",q,[m(u(c(a)("table.name")),1),r[7]||(r[7]=n("span",{class:"text-red-500"},"*",-1))]),p(n("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>s.value.name=e),type:"text",class:"input validator",placeholder:c(a)("table.name"),required:"",minlength:"1"},null,8,Q),[[b,s.value.name]]),n("p",Y,u(c(a)("error.personNameEmpty")),1)]),n("label",$,[n("span",B,u(c(a)("table.department")),1),p(n("input",{"onUpdate:modelValue":r[2]||(r[2]=e=>s.value.department=e),type:"text",class:"input validator",placeholder:c(a)("table.department")},null,8,G),[[b,s.value.department]])]),n("label",H,[n("span",K,u(c(a)("table.avatar")),1),p(n("input",{"onUpdate:modelValue":r[3]||(r[3]=e=>s.value.avatar=e),type:"text",class:"input validator",placeholder:c(a)("table.avatar")},null,8,X),[[b,s.value.avatar]])]),n("label",Z,[n("span",ee,u(c(a)("table.identity")),1),p(n("input",{"onUpdate:modelValue":r[4]||(r[4]=e=>s.value.identity=e),type:"text",class:"input validator",placeholder:c(a)("table.identity")},null,8,ae),[[b,s.value.identity]])]),n("button",te,u(c(a)("button.confirm")),1),n("button",{class:"btn btn-ghost mt-1",type:"reset",onClick:r[5]||(r[5]=a=>e.addOnePersonDrawerRef.closeDrawer())},u(c(a)("button.cancel")),1)],32))}});function ne(e){return new Worker(""+new URL("../assets/importExcel.worker-CttQOf2e.js",import.meta.url).href,{name:null==e?void 0:e.name})}function se({exportInputFileRef:e}){const{t:t}=i(),l="./".replace("./","/"),n=g.useToast(),s=new ne,o=x(O),r=A().personConfig,{getAllPersonList:d,getAlreadyPersonList:p}=f(r),u=(c={handleDeletePerson:function(e){r.deletePerson(e)}},[{label:R.global.t("data.number"),props:"uid"},{label:R.global.t("data.name"),props:"name"},{label:R.global.t("data.department"),props:"department"},{label:R.global.t("data.avatar"),props:"avatar",formatValue:e=>e.avatar?'<img src="'.concat(e.avatar,'" alt="avatar" style="width: 50px; height: 50px;"/>'):"-"},{label:R.global.t("data.identity"),props:"identity"},{label:R.global.t("data.isWin"),props:"isWin",formatValue:e=>e.isWin?R.global.t("data.yes"):R.global.t("data.no")},{label:R.global.t("data.operation"),actions:[{label:R.global.t("data.delete"),type:"btn-error",onClick:e=>{c.handleDeletePerson(e)}}]}]);var c;const b=a(!1),m=a({uid:"",name:"",department:"",avatar:"",identity:""});async function D(){if("zhCn"===R.global.locale.value){return await z("".concat(l,"人口登记表-zhCn.xlsx"))}return await z("".concat(l,"personListTemplate-en.xlsx"))}async function P(e){var a;null==o||o.show(),D(),a={type:"start",data:e,templateData:await D()},s&&s.postMessage(a)}return{resetData:function(){r.resetAlreadyPerson()},deleteAll:function(){r.deleteAllPerson()},handleFileChange:async function(a){s&&(s.onmessage=a=>{if("done"===a.data.type&&(r.resetPerson(),r.addNotPersonList(a.data.data),n.open({message:t("error.importSuccess"),type:"success",position:"top-right"}),e.value&&(e.value.value="")),"error"===a.data.type){if("not right template"===a.data.message)return void n.open({message:t("error.excelFileError"),type:"error",position:"top-right"});n.open({message:a.data.message||t("error.importFail"),type:"error",position:"top-right"})}null==o||o.hide()}),P(await j(a.target.files[0]))},exportData:function(){let e=JSON.parse(JSON.stringify(d.value));for(let t=0;t<e.length;t++)delete e[t].x,delete e[t].y,delete e[t].id,delete e[t].createTime,delete e[t].updateTime,delete e[t].prizeId,e[t].isWin?e[t].isWin=R.global.t("data.yes"):e[t].isWin=R.global.t("data.no"),e[t].prizeTime=e[t].prizeTime.join(","),e[t].prizeName=e[t].prizeName.join(",");let a=JSON.stringify(e);if(a=a.replaceAll(/uid/g,R.global.t("data.number")).replaceAll(/isWin/g,R.global.t("data.isWin")).replaceAll(/department/g,R.global.t("data.department")).replaceAll(/name/g,R.global.t("data.name")).replaceAll(/identity/g,R.global.t("data.identity")).replaceAll(/prizeName/g,R.global.t("data.prizeName")).replaceAll(/prizeTime/g,R.global.t("data.prizeTime")),e=JSON.parse(a),e.length>0){const a=y.json_to_sheet(e),t=y.book_new();y.book_append_sheet(t,a,"Sheet1"),w(t,"data.xlsx")}},alreadyPersonList:p,allPersonList:d,tableColumnList:u,addOnePerson:function(e,a){a.preventDefault();const t=C([v(m.value)]);t[0].id=h(),r.addOnePerson(t),e.closeDrawer(),m.value={}},addPersonModalVisible:b,singlePersonData:m,downloadTemplate:function(){const e=R.global.t("data.xlsxName"),a="".concat(l).concat(e);fetch(a).then(e=>e.blob()).then(a=>{const l=window.URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download=e,s.click(),n.open({message:t("error.downloadSuccess"),type:"success",position:"top-right"})})}}}const oe={class:"min-w-1000px"},re={class:"flex gap-3"},ie=["data-tip"],de={class:""},pe={for:"explore"},ue=["data-tip"],ce={class:"btn btn-primary btn-sm"},be=e({__name:"index",setup(e){const s=a(),o=a(),r=a(),d=a(),{resetData:p,deleteAll:b,handleFileChange:m,exportData:g,addOnePerson:f,singlePersonData:v,alreadyPersonList:h,allPersonList:y,tableColumnList:w,downloadTemplate:x}=se({exportInputFileRef:r}),{t:R}=i();return(e,a)=>(l(),t(k,null,[D(L,{ref_key:"resetDataDialogRef",ref:s,title:c(R)("dialog.titleTip"),desc:c(R)("dialog.dialogResetWinner"),"submit-func":c(p)},null,8,["title","desc","submit-func"]),D(L,{ref_key:"delAllDataDialogRef",ref:o,title:c(R)("dialog.titleTip"),desc:c(R)("dialog.dialogDelAllPerson"),"submit-func":c(b)},null,8,["title","desc","submit-func"]),D(F,{ref_key:"addOnePersonDrawerRef",ref:d},{content:P(()=>[D(le,{"single-person-data":c(v),"onUpdate:singlePersonData":a[0]||(a[0]=e=>_(v)?v.value=e:null),"add-one-person-drawer-ref":d.value,"add-one-person":c(f)},null,8,["single-person-data","add-one-person-drawer-ref","add-one-person"])]),_:1},512),n("div",oe,[D(N,{title:c(R)("viewTitle.personManagement")},{buttons:P(()=>[n("div",re,[n("button",{class:"btn btn-error btn-sm",onClick:a[1]||(a[1]=e=>o.value.showDialog())},u(c(R)("button.allDelete")),1),n("div",{class:"tooltip tooltip-bottom","data-tip":c(R)("tooltip.downloadTemplateTip")},[n("button",{class:"no-underline btn btn-secondary btn-sm",onClick:a[2]||(a[2]=(...e)=>c(x)&&c(x)(...e))},u(c(R)("button.downloadTemplate")),1)],8,ie),n("div",de,[n("label",pe,[n("div",{class:"tooltip tooltip-bottom","data-tip":c(R)("tooltip.uploadExcelTip")},[n("input",{id:"explore",ref_key:"exportInputFileRef",ref:r,type:"file",class:"",style:{display:"none"},accept:".xlsx,.xls",onChange:a[3]||(a[3]=(...e)=>c(m)&&c(m)(...e))},null,544),n("span",ce,u(c(R)("button.importData")),1)],8,ue)])]),n("button",{class:"btn btn-error btn-sm",onClick:a[4]||(a[4]=e=>s.value.showDialog())},u(c(R)("button.resetData")),1),n("button",{class:"btn btn-accent btn-sm",onClick:a[5]||(a[5]=(...e)=>c(g)&&c(g)(...e))},u(c(R)("button.exportResult")),1),n("div",null,[n("span",null,u(c(R)("table.luckyPeopleNumber"))+":",1),n("span",null,u(c(h).length),1),a[6]||(a[6]=n("span",null," / ",-1)),n("span",null,u(c(y).length),1)])])]),_:1},8,["title"]),D(T,{"table-columns":c(w),data:c(y)},null,8,["table-columns","data"])])],64))}});export{be as default};
